<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyTrack - Settings</title>
    <link rel="icon" href="images_icons/fav logo.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="settings.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo"><a href="HomeF.html"><img src="images_icons/logo.png" alt="StudyTrack"></a></div>
        <div class="nav-menu">
            <div class="top-nav">
                <a href="HomeF.html"><img src="images_icons/home.png" alt=""> Home</a>
                <a href="Classes.html"><img src="images_icons/class.png" alt=""> Classes</a>
                <a href="Assignment.html"><img src="images_icons/assignment.png" alt=""> Assignment</a>
                <a href="Reminder.html"><img src="images_icons/reminder.png" alt=""> Reminder</a>
                <a href="Wallet.html"><img src="images_icons/wallet.png" alt=""> Wallet</a>
                <a href="Habits.html"><img src="images_icons/streak.png" alt=""> Habit</a>
            </div>
            <div class="bot-nav">
                <a href="Settings.html" class="active"><img src="images_icons/settings.png" alt=""> Settings</a>
                <a href="#"><img src="images_icons/logout.png" alt=""> Log out</a>
            </div>
        </div>
    </aside>

<!-- Main Content -->
<div class="main-content">
    <div class="container">

        <div class="header">
            <button class="hamburger" id="hamburgerBtn">â˜°</button>
            <div class="greeting">
                <h2><strong style="color: var(--border);">Your</strong> Settings</h2>
                <p>Manage your account preferences and notifications</p>
            </div>
            <button class="theme-toggle" id="themeToggle">
                <img src="images_icons/Sun.png" id="themeIcon">
            </button>
        </div>

        <!-- Profile Card -->
        <div class="profile-card">
            <div class="profile-header">Personal Information</div>

            <div class="profile-grid">
                <div class="avatar-full-height">
                    <div class="profile-avatar">
                        <img src="images_icons/user.png" id="avatarPreview">
                        <input type="file" id="avatarUpload" accept="image/*" style="display:none;">
                    </div>
                    <label for="avatarUpload" class="camera-icon">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2.5">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                        </label>
                </div>

                <div class="info-section">
                    <div class="name-email-row">
                        <div class="form-group">
                            <label>Full name</label>
                            <input type="text" id="fullName" readonly>
                        </div>

                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="text" id="emailAddress" readonly>
                        </div>
                    </div>

                    <div class="password-row">
                        <div class="form-group password-group">
                            <label>Password</label>
                            
                           <div class="password-input-wrapper">
    <input type="password" id="passwordField" value="**********" readonly>
    <svg id="togglePasswordEye" class="eye-icon" width="22" height="22" 
         viewBox="0 0 24 24" fill="none" stroke="currentColor" 
         stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
         style="cursor:pointer;">
        <path d="M1 12s4-8 11-8 11 8 11 8"></path>
        <circle cx="12" cy="12" r="3"></circle>
        <line x1="1" y1="1" x2="23" y2="23" stroke-width="3"></line>
    </svg>
</div>
                        </div>

                        <button class="change-pw-btn">Change Password</button>
                    </div>
                </div>
            </div>

            <div class="profile-actions">
                <button class="btn-cancel">Cancel</button>
                <button class="btn-save">Save Changes</button>
            </div>
        </div>

        <button class="btn-delete">Delete Account</button>

    </div>
</div>
<!-- Main Change Password Modal -->
<div id="changePasswordModal" class="modal-overlay">
    <div class="modal-content" id="pwFormModal">
        <div class="modal-header">
            <h3 id="modalTitle">Change Password</h3>
            <button class="modal-close-btn" id="closePwModal">X</button>
        </div>

        <div class="modal-body">
            <!-- Step 1: Email -->
            <div id="step1" class="form-step active">
                <div class="form-group">
                   
                    <input type="email" id="verifyEmail" placeholder="Enter your email" required>
                </div>
            </div>

            <!-- Step 2: Password -->
            <div id="step2" class="form-step">
                <div class="form-group">
                    
                    <div class="password-input-wrapper">
                        <input type="password" id="newPassword" placeholder="Enter new password" required>
                        <svg class="eye-icon" style="margin-top: -8px;" onclick="togglePasswordVisibility('newPassword')" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </div>
                </div>
                <div class="form-group">
                    <br><br>
                    <div class="password-input-wrapper">
                        <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
                        <svg class="eye-icon" style="margin-top: -8px;" onclick="togglePasswordVisibility('confirmPassword')" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </div>
                </div>
                <p style="font-size:13px; color:var(--text-dim); margin-top:10px;">
                    Password must be at least 8 characters long.
                </p>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn-verify" id="actionBtn">Verify Email</button>
        </div>
    </div>

    <!-- SUCCESS MODAL - Separate, Clean, Beautiful -->
    <div class="modal-content success-modal" id="successModal" style="display:none;">
        <div style="text-align:center; padding:50px 40px;">
            <div style="width:90px; height:90px; background:#28a745; border-radius:50%; margin:0 auto 30px; display:flex; align-items:center; justify-content:center;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 6 L9 17 L4 12"></path>
                </svg>
            </div>
            <h3 style="font-size:26px; font-weight:700; margin-bottom:10px; color:var(--text);">Password Updated</h3>
            <p style="color:var(--text-dim); font-size:15px; margin-bottom:40px;">
                Your password has been changed successfully.
            </p>
            <button class="btn-ok" id="okSuccessBtn">OK</button>
        </div>
    </div>
</div>

    <!-- LOGOUT CONFIRMATION MODAL -->
    <div id="logoutModal" class="modal-logout">
        <div class="modal-logout-content">
            <div class="modal-logout-icon">ðŸ˜¢</div>
            <h2>Are you sure you want to logout?</h2>
            <p>You will be returned to the login page.</p>

            <div class="modal-logout-buttons">
                <button id="cancelLogout" class="modal-logout-cancel-btn">Cancel</button>
                <button id="confirmLogout" class="modal-logout-btn">Logout</button>
            </div>
        </div>
    </div>



    <script>
// =============================
// Securely Load Logged-in User Personal Information
// =============================
document.addEventListener("DOMContentLoaded", function () {
    // Show loading state (optional - add spinner or disable inputs)
    document.getElementById("fullName").value = "Loading...";
    document.getElementById("emailAddress").value = "Loading...";
    document.getElementById("passwordField").value = "************";

    fetch("http://localhost/Group1_StudyTrack/settings.php", {
    method: "GET",
    credentials: "include"   // Sends the session cookie
})
.then(response => response.json())
.then(data => {
    if (!data.success) {
        alert("Please log in again.");
        window.location.href = "Sign-in.html";
        return;
    }

    const user = data.data;
    const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim();
    document.getElementById("fullName").value = fullName || "User";
    document.getElementById("emailAddress").value = user.email || "";
    document.getElementById("avatarPreview").src = user.avatar;
// REAL PASSWORD TOGGLE WITH EYE ICON (100% WORKING)
    const passwordField = document.getElementById("passwordField");
    const eyeIcon = document.getElementById("togglePasswordEye");
    const realPassword = user.plain_password || "12345678";

    let isVisible = false;

    eyeIcon.addEventListener("click", () => {
        if (isVisible) {
            // HIDE PASSWORD
            passwordField.type = "password";
            passwordField.value = "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢";
            eyeIcon.innerHTML = `
                <path d="M1 12s4-8 11-8 11 8 11 8"></path>
                <circle cx="12" cy="12" r="3"></circle>
                <line x1="1" y1="1" x2="23" y2="23" stroke-width="3"></line>
            `;
        } else {
            // SHOW REAL PASSWORD
            passwordField.type = "text";
            passwordField.value = realPassword;
            eyeIcon.innerHTML = `
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            `;
        }
        isVisible = !isVisible;
    });
})
.catch(err => {
    console.error("Error:", err);
    alert("Session error. Please log in again.");
    window.location.href = "Sign-in.html";
});
});
     //Logout Modal
    const logoutTrigger = document.querySelector('.bot-nav a[href="#"]');

   
    const logoutModal = document.getElementById('logoutModal');
    const cancelLogoutBtn = document.getElementById('cancelLogout');
    const confirmLogoutBtn = document.getElementById('confirmLogout');

 
    logoutTrigger.addEventListener('click', (e) => {
        e.preventDefault();
        logoutModal.style.display = "flex";
    });


    cancelLogoutBtn.addEventListener('click', () => {
        logoutModal.style.display = "none";
    });

  
    confirmLogoutBtn.addEventListener('click', () => {
        window.location.href = "Sign-in.html"; 
    });

  
    window.addEventListener('click', (e) => {
        if (e.target === logoutModal) {
            logoutModal.style.display = "none";
        }
    });

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-theme');
            themeIcon.src = 'images_icons/moon.png';
        } else { themeIcon.src = 'images_icons/Sun.png'; }
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            if (document.body.classList.contains('light-theme')) {
                localStorage.setItem('theme', 'light');
                themeIcon.src = 'images_icons/moon.png';
            } else {
                localStorage.setItem('theme', 'dark');
                themeIcon.src = 'images_icons/sun.png';
            }
        });

        // Hamburger
        document.getElementById('hamburgerBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('sidebar').classList.toggle('active');
            document.querySelector('.main-content').classList.toggle('shift');
        });

        // Avatar preview
        document.getElementById('avatarUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(ev) { document.getElementById('avatarPreview').src = ev.target.result; }
                reader.readAsDataURL(file);
            }
        });
const modalOverlay   = document.getElementById('changePasswordModal');
    const pwFormModal    = document.getElementById('pwFormModal');
    const successModal   = document.getElementById('successModal');
    const actionBtn      = document.getElementById('actionBtn');
    const closeBtn       = document.getElementById('closePwModal');
    const okBtn          = document.getElementById('okSuccessBtn');

    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');

    let currentStep = 1;

    // Open Modal
    document.querySelector('.change-pw-btn').addEventListener('click', () => {
        modalOverlay.style.display = 'flex';
        setTimeout(() => modalOverlay.classList.add('active'), 10);
        currentStep = 1;
        step1.classList.add('active');
        step2.classList.remove('active');
        pwFormModal.style.display = 'block';
        successModal.style.display = 'none';
        document.getElementById('verifyEmail').focus();
    });

    // Close Modal
    function closeAll() {
        modalOverlay.classList.remove('active');
        setTimeout(() => {
            modalOverlay.style.display = 'none';
        }, 300);
    }
    closeBtn.onclick = closeAll;
    modalOverlay.onclick = (e) => { if (e.target === modalOverlay) closeAll(); };

    // Toggle Password Visibility
    function togglePasswordVisibility(id) {
        const input = document.getElementById(id);
        const icon = input.parentElement.querySelector('.eye-icon');
        if (input.type === 'password') {
            input.type = 'text';
            icon.innerHTML = `<path d="M1 12s4-8 11-8 11 8 11 8"/>`;
        } else {
            input.type = 'password';
            icon.innerHTML = `<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>`;
        }
    }
    

    // Action Button Click
    actionBtn.onclick = () => {
        if (currentStep === 1) {
            const email = document.getElementById('verifyEmail').value.trim();
            if (!email || !email.includes('@') || !email.includes('.')) {
                alert("Please enter a valid email");
                return;
            }
            actionBtn.textContent = "Sending...";
            actionBtn.disabled = true;
            setTimeout(() => {
                currentStep = 2;
                step1.classList.remove('active');
                step2.classList.add('active');
                actionBtn.textContent = "Update Password";
                actionBtn.disabled = false;
                document.getElementById('newPassword').focus();
            }, 1200);

        } else if (currentStep === 2) {
            const pw1 = document.getElementById('newPassword').value;
            const pw2 = document.getElementById('confirmPassword').value;

            if (pw1.length < 8) return alert("Password must be at least 8 characters");
            if (pw1 !== pw2) return alert("Passwords do not match");

            // Show Success Modal
            pwFormModal.style.display = 'none';
            successModal.style.display = 'block';
        }
    };

    // OK Button in Success Modal
    okBtn.onclick = closeAll;

    // Enter key support
    modalOverlay.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && currentStep < 3 && modalOverlay.style.display === 'flex') {
            e.preventDefault();
            actionBtn.click();
        }
    });
    </script>
</body>
</html>
